# D-Agent: ä¸€ä¸ªæ¨¡å—åŒ–çš„ AI ä»£ç†æ¡†æ¶

D-Agent æ˜¯ä¸€ä¸ªç”¨äºå­¦ä¹ å’Œå®è·µç°ä»£ AI ä»£ç†ï¼ˆAgentï¼‰æ¶æ„çš„æ²™ç›’é¡¹ç›®ã€‚å®ƒä»é›¶å¼€å§‹æ„å»ºäº†ä¸€ä¸ªå…·å¤‡æ€è€ƒã€å†³ç­–å’Œå·¥å…·ä½¿ç”¨èƒ½åŠ›çš„æ™ºèƒ½ä»£ç†ï¼Œå¹¶é‡ç‚¹æ¼”ç¤ºäº†ä»¥ä¸‹æ ¸å¿ƒæ¦‚å¿µçš„é›†æˆï¼š

* **ä»£ç†æ¶æ„ (Agent Architecture)**: å®ç°äº†ä¸€ä¸ªåŸºäº "æ€è€ƒ -> è¡ŒåŠ¨" å¾ªç¯çš„æ ¸å¿ƒä»£ç†ã€‚
* **å…ƒè®¤çŸ¥åè®® (MCP - Meta-Cognitive Protocol)**: è®¾è®¡äº†ä¸€å¥—æ ‡å‡†åŒ–çš„æ¶ˆæ¯å’Œå·¥å…·æ¥å£ï¼Œå®ç°ç³»ç»Ÿå„ç»„ä»¶çš„è§£è€¦ã€‚
* **æ£€ç´¢å¢å¼ºç”Ÿæˆ (RAG - Retrieval-Augmented Generation)**: é›†æˆäº†ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„çŸ¥è¯†åº“æ£€ç´¢æµç¨‹ï¼Œåœ¨ä»£ç†å†³ç­–å‰ä¸ºå…¶æä¾›ç›¸å…³èƒŒæ™¯çŸ¥è¯†ã€‚

---

## æ ¸å¿ƒæ¦‚å¿µ

æœ¬é¡¹ç›®æ—¨åœ¨å°†ç†è®ºæ¦‚å¿µè½¬åŒ–ä¸ºå¯è¿è¡Œçš„ä»£ç ï¼š

1.  **MCP (Meta-Cognitive Protocol)**
    * åœ¨æœ¬é¡¹ç›®ä¸­ï¼ŒMCP ä½“ç°åœ¨ `mcp/` ç›®å½•ä¸‹çš„ `protocol.py` å’Œ `interfaces.py`ã€‚
    * `MCPMessage` å®šä¹‰äº†ç³»ç»Ÿå†…æ‰€æœ‰ç»„ä»¶ï¼ˆç”¨æˆ·ã€ä»£ç†ã€å·¥å…·ï¼‰ä¹‹é—´é€šä¿¡çš„æ ‡å‡†â€œä¿¡å°â€ã€‚
    * `BaseTool` å®šä¹‰äº†æ‰€æœ‰å·¥å…·å¿…é¡»éµå®ˆçš„â€œæ¥å£è§„èŒƒâ€ï¼Œç¡®ä¿ä»»ä½•å·¥å…·éƒ½èƒ½è¢«ä»£ç†åŠ¨æ€åŠ è½½å’Œä½¿ç”¨ã€‚

2.  **RAG (Retrieval-Augmented Generation)**
    * æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ª**è‡ªåŠ¨åŒ–çš„ RAG é¢„å¤„ç†æ­¥éª¤**ã€‚
    * åœ¨ä»£ç†æ¥æ”¶åˆ°ä»»ä½•ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå®ƒä¼š**é¦–å…ˆ**ä½¿ç”¨ `RAGTool` ä»æœ¬åœ°çŸ¥è¯†åº“ï¼ˆå‘é‡æ•°æ®åº“ï¼‰ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ã€‚
    * è¿™äº›æ£€ç´¢åˆ°çš„ä¿¡æ¯ä¼šä½œä¸ºâ€œèƒŒæ™¯èµ„æ–™â€è¢«æ³¨å…¥åˆ°æç¤ºè¯ä¸­ï¼Œå¸®åŠ© LLM åšå‡ºæ›´â€œçŸ¥æƒ…â€çš„å†³ç­–ã€‚

3.  **Agent (æ™ºèƒ½ä»£ç†)**
    * `agent.py` ä¸­çš„ `SmartAgent` æ˜¯ç³»ç»Ÿçš„â€œå¤§è„‘â€å’Œâ€œè°ƒåº¦ä¸­å¿ƒâ€ã€‚
    * å®ƒ**ä¸ç›´æ¥æ‰§è¡Œ**å…·ä½“ä»»åŠ¡ï¼Œè€Œæ˜¯é€šè¿‡ LLM æ¥**ç†è§£ç”¨æˆ·æ„å›¾**ï¼Œå¹¶**å†³ç­–**ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼šæ˜¯ç›´æ¥å›ç­”ï¼Œè¿˜æ˜¯è°ƒç”¨ä¸€ä¸ªåˆé€‚çš„å·¥å…·ã€‚

## é¡¹ç›®æ¶æ„

```
D-Agent/
â”œâ”€â”€ .env.template         # API å¯†é’¥çš„æ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ .gitignore            # Git å¿½ç•¥è§„åˆ™
â”œâ”€â”€ agent.py              # SmartAgent çš„æ ¸å¿ƒå®ç°
â”œâ”€â”€ build_rag_index.py    # [è¿è¡Œä¸€æ¬¡] ç”¨äºæ„å»º RAG çŸ¥è¯†åº“çš„è„šæœ¬
â”œâ”€â”€ main.py               # é¡¹ç›®çš„ä¸»å…¥å£ï¼Œæ”¯æŒäº¤äº’å’Œæ¨¡æ‹Ÿæ¨¡å¼
â”œâ”€â”€ requirements.txt      # é¡¹ç›®çš„ Python ä¾èµ–
â”œâ”€â”€ data/                 # å­˜æ”¾ RAG çš„åŸå§‹çŸ¥è¯†æ–‡æ¡£ (.txt)
â”‚Â Â  â”œâ”€â”€ apple_intro.txt
â”‚Â Â  â””â”€â”€ google_intro.txt
â”œâ”€â”€ mcp/                  # MCP æ ¸å¿ƒå®šä¹‰åŒ…
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ interfaces.py     # å®šä¹‰äº† BaseTool ç­‰æ¥å£
â”‚Â Â  â””â”€â”€ protocol.py       # å®šä¹‰äº† MCPMessage æ¶ˆæ¯æ ¼å¼
â””â”€â”€ tools/                # å­˜æ”¾æ‰€æœ‰å¯è¢«ä»£ç†åŠ¨æ€åŠ è½½çš„å·¥å…·
 Â Â  â”œâ”€â”€ __init__.py
 Â Â  â”œâ”€â”€ calculator_tool.py
 Â Â  â””â”€â”€ rag_tool.py
```

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

* **åŠ¨æ€å·¥å…·åŠ è½½**: ä»£ç†åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰«æ `tools/` ç›®å½•å¹¶åŠ è½½æ‰€æœ‰ç¬¦åˆ `BaseTool` è§„èŒƒçš„å·¥å…·ã€‚
* **RAG å¢å¼ºå†³ç­–**: åœ¨æ¯æ¬¡å†³ç­–å‰ï¼Œä»£ç†ä¼šè‡ªåŠ¨æŸ¥è¯¢å†…éƒ¨çŸ¥è¯†åº“ï¼Œä¸º LLM æä¾›å†³ç­–æ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚
* **LLM é©±åŠ¨çš„å†³ç­–æ ¸å¿ƒ**: ä½¿ç”¨ OpenAI çš„ `gpt-4o` ç­‰æ¨¡å‹ä½œä¸ºä»£ç†çš„â€œå¤§è„‘â€ï¼Œè´Ÿè´£ç†è§£æ„å›¾ã€é€‰æ‹©å·¥å…·å’Œæå–å‚æ•°ã€‚
* **æ ‡å‡†åŒ–æ¥å£**: æ‰€æœ‰å·¥å…·å’Œæ¶ˆæ¯éƒ½éµå¾ªç»Ÿä¸€çš„ MCP è§„èŒƒï¼Œæ˜“äºæ‰©å±•ã€‚
* **åŒæ¨¡å¼è¿è¡Œ**: æ”¯æŒä¸ä»£ç†ç›´æ¥å¯¹è¯çš„**äº¤äº’æ¨¡å¼**å’Œç”¨äºæµ‹è¯•çš„**æ¨¡æ‹Ÿæ¨¡å¼**ã€‚
* **å®‰å…¨çš„å¯†é’¥ç®¡ç†**: é€šè¿‡ `.env` æ–‡ä»¶ç®¡ç†æ•æ„Ÿçš„ API å¯†é’¥ï¼Œé¿å…ç¡¬ç¼–ç ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

* ç¡®ä¿ä½ å·²å®‰è£… [Git](https://git-scm.com/)ã€‚
* ç¡®ä¿ä½ å·²å®‰è£… [Python 3.10+](https://www.python.org/) å’Œ [Conda](https://docs.conda.io/en/latest/miniconda.html)ã€‚

### 2. é¡¹ç›®è®¾ç½®

1.  **å…‹éš†ä»“åº“**
    ```bash
    git clone https://github.com/Erber102/D-Agent.git
    cd D-Agent
    ```

2.  **åˆ›å»ºå¹¶æ¿€æ´» Conda ç¯å¢ƒ**
    ```bash
    conda create --name agent python=3.10 -y
    conda activate agent
    ```

3.  **å®‰è£…ä¾èµ–**
    ```bash
    pip install -r requirements.txt
    ```

4.  **é…ç½® API å¯†é’¥**
    * å¤åˆ¶æ¨¡æ¿æ–‡ä»¶ï¼š
        ```bash
        cp .env.template .env
        ```
    * ç¼–è¾‘æ–°åˆ›å»ºçš„ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ [OpenAI API Key](https://platform.openai.com/api-keys)ã€‚

5.  **æ„å»º RAG çŸ¥è¯†åº“**
    è¿™æ˜¯ä¸€ä¸ªä¸€æ¬¡æ€§çš„æ­¥éª¤ï¼Œç”¨äºå¤„ç† `data/` ç›®å½•ä¸‹çš„æ–‡æ¡£å¹¶åˆ›å»ºå‘é‡æ•°æ®åº“ã€‚
    ```bash
    python build_rag_index.py
    ```
    è¿è¡ŒæˆåŠŸåï¼Œä½ ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ª `rag_db` æ–‡ä»¶å¤¹ã€‚

### 3. è¿è¡Œä»£ç†

é¡¹ç›®æ”¯æŒä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š

* **äº¤äº’æ¨¡å¼ (é»˜è®¤)**
    ç›´æ¥è¿è¡Œ `main.py`ï¼Œå³å¯å¼€å§‹ä¸ä»£ç†å¯¹è¯ã€‚
    ```bash
    python main.py
    ```
    **ç¤ºä¾‹å¯¹è¯:**
    ```
    > ğŸ‘¤ You: è‹¹æœå…¬å¸æ˜¯è°åˆ›ç«‹çš„ï¼Ÿ
    > ğŸ§  Agent is thinking...
    > âœ… Problem Solved!
    > ğŸ¤– Agent: æ ¹æ®çŸ¥è¯†åº“ä¿¡æ¯ï¼Œè‹¹æœå…¬å¸æ˜¯ç”±å²è’‚å¤«Â·ä¹”å¸ƒæ–¯ã€æ–¯è’‚å¤«Â·æ²ƒå…¹å°¼äºšå…‹å’Œç½—æ©Â·éŸ¦æ©ç­‰äººåˆ›ç«‹çš„ã€‚
    ```

* **æ¨¡æ‹Ÿæ¨¡å¼**
    ä½¿ç”¨ `--simulate` æ ‡å¿—æ¥è¿è¡Œé¢„è®¾çš„æµ‹è¯•ç”¨ä¾‹ã€‚
    ```bash
    python main.py --simulate
    ```

---

## ğŸ”§ å¦‚ä½•æ‰©å±•ï¼šæ·»åŠ æ–°å·¥å…·

æœ¬æ¡†æ¶çš„è®¾è®¡ä½¿å¾—æ·»åŠ æ–°å·¥å…·å˜å¾—éå¸¸ç®€å•ï¼š

1.  **åˆ›å»ºå·¥å…·æ–‡ä»¶**: åœ¨ `tools/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ Python æ–‡ä»¶ï¼Œä¾‹å¦‚ `my_new_tool.py`ã€‚

2.  **å®ç°å·¥å…·ç±»**: åœ¨æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª `mcp.interfaces.BaseTool` çš„ç±»ã€‚

3.  **éµå¾ªæ¥å£è§„èŒƒ**:
    * åœ¨ `__init__` æ–¹æ³•ä¸­ï¼Œå®šä¹‰å·¥å…·çš„ `name`, `description` å’Œ `parameters`ã€‚è¿™æ˜¯ç»™ LLM çœ‹çš„â€œå·¥å…·è¯´æ˜ä¹¦â€ã€‚
    * å®ç° `execute` æ–¹æ³•ï¼Œç¼–å†™å·¥å…·çš„æ ¸å¿ƒé€»è¾‘ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»æ˜¯ä¸€ä¸ªåŒ…å« `status` å­—æ®µçš„å­—å…¸ã€‚

    **æ¨¡æ¿:**
    ```python
    # tools/my_new_tool.py
    from typing import Dict, Any
    from mcp.interfaces import BaseTool

    class MyNewTool(BaseTool):
        def __init__(self):
            name = "my_new_tool"
            description = "è¿™é‡Œæ˜¯æ–°å·¥å…·çš„è¯¦ç»†æè¿°ï¼Œå‘Šè¯‰LLMå®ƒèƒ½åšä»€ä¹ˆã€‚"
            parameters = [
                {
                    "name": "param1",
                    "type": "string",
                    "description": "å‚æ•°1çš„æè¿°ã€‚"
                }
            ]
            super().__init__(name, description, parameters)

        def execute(self, **kwargs: Any) -> Dict[str, Any]:
            param1_value = kwargs.get("param1")
            # ...ä½ çš„å·¥å…·é€»è¾‘...
            return {"status": "success", "result": "ä»»åŠ¡å®Œæˆï¼"}
    ```

4.  **å®Œæˆ**ï¼ä¸‹æ¬¡å¯åŠ¨ `main.py` æ—¶ï¼Œ`SmartAgent` ä¼šè‡ªåŠ¨å‘ç°å¹¶åŠ è½½ä½ çš„æ–°å·¥å…·ã€‚

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)ã€‚